{
  "version": "3",
  "services": [
    {
      "name": "ttrss-db",
      "image": "postgres:15-alpine",
      "restart": "unless-stopped",
      "networks": [
        { "name": "ttrss_network", "gw_priority": 0 }
      ],
      "environment": {
        "POSTGRES_USER": "postgres",
        "POSTGRES_PASSWORD": "password",
        "POSTGRES_DB": "postgres"
      },
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/ttrss-db",
          "containerPath": "/var/lib/postgresql/data",
          "readOnly": false
        }
      ],
      "labels": {
        "runtipi.managed": "true",
        "runtipi.appurn": "ttrss:main"
      }
    },
    {
      "name": "app",
      "image": "cthulhoo/ttrss-fpm-pgsql-static:latest",
      "restart": "unless-stopped",
      "networks": [
        { "name": "ttrss_network", "gw_priority": 0 }
      ],
      "environment": {
        "TTRSS_DB_HOST": "ttrss-db",
        "TTRSS_DB_USER": "postgres",
        "TTRSS_DB_NAME": "postgres",
        "TTRSS_DB_PASS": "password"
      },
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/ttrss-app",
          "containerPath": "/var/www/html",
          "readOnly": false
        },
        {
          "hostPath": "./config.d",
          "containerPath": "/opt/tt-rss/config.d",
          "readOnly": true
        }
      ],
      "depends_on": ["ttrss-db"],
      "labels": {
        "runtipi.managed": "true",
        "runtipi.appurn": "ttrss:main"
      }
    },
    {
      "name": "ttrss-updater",
      "image": "cthulhoo/ttrss-fpm-pgsql-static:latest",
      "restart": "unless-stopped",
      "networks": [
        { "name": "ttrss_network", "gw_priority": 0 }
      ],
      "environment": {
        "TTRSS_DB_HOST": "ttrss-db",
        "TTRSS_DB_USER": "postgres",
        "TTRSS_DB_NAME": "postgres",
        "TTRSS_DB_PASS": "password"
      },
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/ttrss-app",
          "containerPath": "/var/www/html",
          "readOnly": false
        },
        {
          "hostPath": "./config.d",
          "containerPath": "/opt/tt-rss/config.d",
          "readOnly": true
        }
      ],
      "depends_on": ["app"],
      "command": "/opt/tt-rss/updater.sh",
      "labels": {
        "runtipi.managed": "true",
        "runtipi.appurn": "ttrss:main"
      }
    },
    {
      "name": "ttrss-web",
      "image": "cthulhoo/ttrss-web-nginx:latest",
      "restart": "unless-stopped",
      "networks": [
        { "name": "runtipi_tipi_main_network", "gw_priority": 1 },
        { "name": "ttrss_network", "gw_priority": 0 }
      ],
      "environment": {
        "TTRSS_DB_HOST": "ttrss-db",
        "TTRSS_DB_USER": "postgres",
        "TTRSS_DB_NAME": "postgres",
        "TTRSS_DB_PASS": "password",
        "HTTP_PORT": "80",
        "TTRSS_ROOT": "/var/www/html/tt-rss"
      },
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/ttrss-app",
          "containerPath": "/var/www/html/tt-rss",
          "readOnly": true
        }
      ],
      "depends_on": ["app"],
      "labels": {
        "traefik.enable": "true",
        "traefik.docker.network": "runtipi_tipi_main_network",
        "traefik.http.routers.ttrss-local.rule": "Host(`ttrss.tip.fritz.box`)",
        "traefik.http.routers.ttrss-local.entrypoints": "websecure",
        "traefik.http.routers.ttrss-local.tls": "true",
        "traefik.http.routers.ttrss-local.service": "ttrss",
        "traefik.http.services.ttrss.loadbalancer.server.port": "80",
        "runtipi.managed": "true",
        "runtipi.appurn": "ttrss:main"
      }
    }
  ],
  "networks": [
    {
      "name": "runtipi_tipi_main_network",
      "external": true
    },
    {
      "name": "ttrss_network",
      "external": false,
      "ipam": {
        "config": [
          { "subnet": "10.128.14.0/24" }
        ]
      }
    }
  ]
}